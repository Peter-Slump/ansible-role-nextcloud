---

dependencies:
  - src: https://github.com/Peter-Slump/ansible-role-nginx.git
    version: v0.0.5
    scm: git
    name: nginx
  - src: https://github.com/Peter-Slump/ansible-role-postgresql.git
    version: v0.0.1
    scm: git
    name: postgresql
  - src: https://github.com/Peter-Slump/ansible-role-php-fpm.git
    version: v0.0.2
    scm: git
    name: php-fpm

  - role: nginx
    nginx_ssl_hostname: "{{ nextcloud_hostname }}"
    nginx_use_letsencrypt: "{{ nextcloud_use_letsencrypt }}"
    nginx_use_self_signed_ssl: "{{ nextcloud_use_self_signed_ssl }}"
  - role: postgresql
    when: nextcloud_db_type == 'postgresql'
  - role: mariadb
    when: nextcloud_db_type == 'mariadb'
  - role: php-fpm
    php_fpm_additional_packages:
      - openssl
      - php7.0-curl
      - php7.0-gd
      - php-imagick
      - php7.0-intl
      - php7.0-json
      - php7.0-mcrypt
      - php7.0-pgsql
      - php7.0-imap
      - php-memcached
      - php-apcu
      - php-zip
    php_fpm_pools:
      - name: nextcloud
        listen: '127.0.0.1:{{ nextcloud_php_port }}'
        user: '{{ nextcloud_user }}'
        group: '{{ nextcloud_group }}'
        php_value:
          output_buffering: '{{ nextcloud_php_output_buffering }}'
          post_max_size: '{{ nextcloud_upload_size }}'
          upload_max_filesize: '{{ nextcloud_upload_size }}'
        environment:
          PATH: "{{ ansible_env.PATH }}"
          HOSTNAME: "{{ ansible_hostname }}"
